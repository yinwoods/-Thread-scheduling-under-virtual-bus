{% extends "layout.html" %}
{% block title  %}演示项目{% endblock %}

{% block page_content %}

	<div class="container">
		<div class="row">

			<div class="hero-unit col-md-4">

				<form action="" method="post" class="form" role="form">
  					{{ form.hidden_tag() }}

					<div class="form-group  required">
						<label class="control-label" for="device_num">输入要创建设备个数：</label>
						{% for message in get_flashed_messages() %}
					    <div class="alert alert-danger alert-dismissible fade in" role="alert">
					        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
					            <span aria-hidden="true">&times;</span>
					        </button>
					        {{ message }}
					    </div>
					    {% endfor %}
          				<input class="form-control" id="device_num" name="device_num" required="" type="text" value="">
					</div>
				
					<div class="form-group  required">
						<label class="control-label" for="global_status">输入状态位：</label>
		      			<input class="form-control" id="global_status" name="global_status" required="" type="text" value="">
		    
					</div>

					<button class="btn btn-primary" id="submit" type="submit">演示项目</button>

				</form>

				<br><br><hr class="hr0"><br><br>

				<span><h3 class="text-center">CPU利用率</h3></span>

				<div class="progress">
					<div class="progress-bar progress-bar-striped" id="test" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:0%">
						<span id="bb">100% CPU</span>
					</div>
				</div>
				
				<br>

				<div>
					<form action="" method="post" class="form" role="form">
						{{ form.hidden_tag() }}
						<div class="form-group required">
							<label class="control-label" for="cpu_time">输入想要限制的CPU比例：</label>
								<input class="form-control" id="cpu_time" name="cpu_time" required="" type="" value="">
							</label>
						</div>
						<button class="btn btn-info" id="submit" type="submit">限制CPU</button>
					</form>
					
					<script type="text/javascript">
						var total = 10000;
						var breaker = 100;
						var step = 100/(total/breaker);
						var progress = 0;

						{% if cpu_time %}
							var cpu_time = {{ cpu_time }};
						{% else %}
							var cpu_time = 0
						{% endif %}
						
						var timer = setInterval(function(){
							progress = progress + step;
							<!-- 读取CPU利用率到进度条 -->
						    $("#bb").html(progress + "% CPU");
						    $("#test").attr("style", "width:" + progress + "%");

						    if(progress >= 20) {
						    	$("#test").attr("class", "progress-bar progress-bar-success  progress-bar-striped");
						    }

						    if(progress >= 40) {
						    	$("#test").attr("class", "progress-bar progress-bar-primary  progress-bar-striped");
						    }

						    if(progress >= 60) {
						    	$("#test").attr("class", "progress-bar progress-bar-warning  progress-bar-striped");
						    }

						    if(progress >= 80) {
						    	$("#test").attr("class", "progress-bar progress-bar-danger  progress-bar-striped");
						    }

						    if (progress >= cpu_time) {
						        clearInterval(timer);
						    }
						}, breaker);
					</script>
				</div>
			</div>

			<div class="col-md-8">
				{% if device_num %}<h4>设备个数:<span class="badge badge-large badge-inverse">{{ device_num }}</span>{% else %}待输入</h4>{% endif %}
				{% if global_status %}<h4>状态位:<span class="badge badge-inverse">{{ global_status }}</span>{% else %}待输入</h4>{% endif %}

				<hr>

				<center><h2>字符设备内容</h2></center>
				{% for doc in doc_json %}
					<h4>{{ doc }}</h4>
				{% endfor %}

				<hr>
				
				<center><h2>设备状态表</h2></center>

				<table class="table table-striped table-hover">
					<thead class="thead-inverse">
						<tr>
							<th>设备编号</th>
							<th>设备类型</th>
							<th>计算结果</th>
							<th>是否损坏</th>
						</tr>
					</thead>
					<tbody>
						{% if global_status %}
						{% for status in global_status.strip() if not status == ',' %}
						<tr>
							<th>{{ status }}</th>
							<td>
								{% if staus == '0' %} 主 {% endif %}
								
								{% if status == '1' %} 热 {% endif %}
								
								{% if status == '2' %} 冷 {% endif %}

								{% if status == '3' %} 损坏 {% endif %}
							</td>
							<td>待补充</td>
							<td>
								{% if status == '3' %} 是 {% else %} 否 {% endif %}
							</td>
						</tr>
						{% endfor %}
						{% endif %}
					</tbody>
				</table>

				<hr>

				
				<!--
				<div class="progress">
					<div class="progress-bar progress-bar-primary  progress-bar-striped" id="processbar" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width:0%">
					<span id="aa">80% CPU</span>
					</div>
				</div>
				<script type="text/javascript">
				var total=10000;
				var breaker=100;
				var turn=100/(total/breaker);
				var progress=0;
				var timer = setInterval(function(){
				    progress=progress+turn;
				    $("#aa").html(progress+"% CPU");
				    $("#processbar").attr("style", "width:"+progress+"%");
				    if (progress>=100) {
				        clearInterval(timer);
				    }
				}, breaker);
				</script>
				-->
			</div>
		</div>
	</div>
{% endblock %}